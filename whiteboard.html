<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valiant Vision | Professional Whiteboard</title>

  <style>
    /* ===== VALIANT VISION THEME ===== */
    :root {
      --bg-gradient: linear-gradient(135deg, #1e3a8a, #9333ea, #3b82f6);
      --toolbar-bg: rgba(255, 255, 255, 0.3);
      --accent: #60a5fa;
      --pen-color: #000000;
      --text-color: #1e293b;
      --sticky-bg: #fffa91;
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: var(--bg-gradient);
      background-size: 400% 400%;
      animation: gradientShift 12s ease infinite;
      font-family: 'Poppins', sans-serif;
      color: var(--text-color);
      height: 100vh;
      width: 100vw;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* ===== TOOLBAR ===== */
    #toolbar {
      position: fixed;
      top: 0;
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      background: var(--toolbar-bg);
      backdrop-filter: blur(12px);
      padding: 0.5rem 1rem;
      z-index: 2000;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .toolbar-section {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .tool-btn, .tool-select, #colorPicker, #lineWidth {
      border: none;
      outline: none;
      border-radius: 12px;
      background: rgba(255,255,255,0.6);
      color: #333;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .tool-btn:hover, .tool-select:hover {
      background: var(--accent);
      color: #fff;
      transform: translateY(-2px);
    }

    .tool-btn.active {
      background: var(--accent);
      color: white;
      font-weight: bold;
    }

    #colorPicker {
      width: 35px;
      height: 35px;
      padding: 0;
      cursor: pointer;
    }

    #shapeSelect {
      font-size: 0.95rem;
      background: rgba(255,255,255,0.8);
    }

    #toggleGrid, #toggleTheme {
      font-size: 1.2rem;
    }

    /* ===== CANVAS ===== */
    #whiteboard {
      position: absolute;
      top: 70px;
      left: 0;
      width: 100%;
      height: calc(100vh - 70px);
      background: #fff;
      cursor: crosshair;
    }

    /* ===== STICKY NOTES ===== */
    .sticky-note {
      position: absolute;
      width: 180px;
      min-height: 150px;
      background: var(--sticky-bg);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      border-radius: 10px;
      padding-top: 25px;
      z-index: 5000;
      resize: both;
      overflow: hidden;
    }

    .sticky-note textarea {
      width: 100%;
      height: calc(100% - 25px);
      border: none;
      outline: none;
      padding: 8px;
      font-size: 1rem;
      background: transparent;
      resize: none;
      color: #111;
    }

    .note-header {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 25px;
      background: rgba(0,0,0,0.1);
      cursor: move;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }

    .note-header .close-btn {
      float: right;
      margin-right: 8px;
      color: #000;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
    }

    /* ===== DARK THEME ===== */
    body.dark {
      --toolbar-bg: rgba(20,20,30,0.85);
      --accent: #a78bfa;
      --pen-color: #f5f5f5;
      background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
      color: #f1f5f9;
    }

    /* Scrollbar hidden for notes */
    ::-webkit-scrollbar {
      width: 0;
      background: transparent;
    }
  </style>
</head>

<body>
  <!-- ===== TOOLBAR ===== -->
  <nav id="toolbar">
    <div class="toolbar-section">
      <button id="penTool" class="tool-btn active" title="Pen">üñäÔ∏è</button>
      <button id="eraserTool" class="tool-btn" title="Eraser">ü©π</button>
      <select id="shapeSelect" class="tool-select" title="Shapes">
        <option value="none">Shapes ‚ñº</option>
        <option value="rectangle">Rectangle ‚ñ≠</option>
        <option value="circle">Circle ‚óØ</option>
        <option value="line">Line /</option>
        <option value="arrow">Arrow ‚ûú</option>
        <option value="triangle">Triangle ‚ñ≤</option>
        <option value="diamond">Diamond ‚óÜ</option>
        <option value="star">Star ‚òÖ</option>
        <option value="heart">Heart ‚ù§</option>
        <option value="cloud">Cloud ‚òÅ</option>
        <option value="polygon">Polygon üî∑</option>
      </select>
      <input type="color" id="colorPicker" value="#000000" title="Choose color" />
      <input type="range" id="lineWidth" min="1" max="20" value="2" title="Line width" />
    </div>

    <div class="toolbar-section">
      <button id="textTool" class="tool-btn" title="Text">üî§</button>
      <button id="addStickyBtn" class="tool-btn" title="Add Sticky Note">üóíÔ∏è</button>
    </div>

    <div class="toolbar-section">
      <button id="undoBtn" class="tool-btn" title="Undo">‚Ü©Ô∏è</button>
      <button id="redoBtn" class="tool-btn" title="Redo">‚Ü™Ô∏è</button>
      <button id="clearBoard" class="tool-btn" title="Clear Board">üßπ</button>
      <button id="downloadBtn" class="tool-btn" title="Download PNG">üíæ</button>
    </div>

    <div class="toolbar-section">
      <button id="toggleGrid" class="tool-btn" title="Toggle Grid">#Ô∏è‚É£</button>
      <button id="toggleTheme" class="tool-btn" title="Toggle Theme">üåó</button>
    </div>
  </nav>

  <!-- ===== CANVAS ===== -->
  <canvas id="whiteboard"></canvas>

  <!-- ===== JAVASCRIPT ===== -->
  <script>
    const canvas = document.getElementById('whiteboard');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    let tool = 'pen';
    let startX = 0, startY = 0;
    let undoStack = [], redoStack = [];
    let color = document.getElementById('colorPicker').value;
    let lineWidth = document.getElementById('lineWidth').value;
    let shape = 'none';
    let gridEnabled = false;

    function resizeCanvas() {
      const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 70;
      ctx.putImageData(img, 0, 0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // ===== TOOL SELECTION =====
    document.getElementById('penTool').onclick = () => setTool('pen');
    document.getElementById('eraserTool').onclick = () => setTool('eraser');
    document.getElementById('textTool').onclick = () => setTool('text');
    document.getElementById('shapeSelect').onchange = (e) => {
      shape = e.target.value;
      setTool('shape');
    };

    function setTool(t) {
      tool = t;
      document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
      if (t === 'pen') document.getElementById('penTool').classList.add('active');
      if (t === 'eraser') document.getElementById('eraserTool').classList.add('active');
      if (t === 'text') document.getElementById('textTool').classList.add('active');
    }

    document.getElementById('colorPicker').onchange = (e) => color = e.target.value;
    document.getElementById('lineWidth').oninput = (e) => lineWidth = e.target.value;

    // ===== DRAWING =====
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchstart', e => startDraw(e.touches[0]));
    canvas.addEventListener('touchmove', e => draw(e.touches[0]));
    canvas.addEventListener('touchend', stopDraw);

    function startDraw(e) {
      drawing = true;
      startX = e.clientX;
      startY = e.clientY - 70;
      if (tool === 'text') addText(startX, startY);
      saveHistory();
    }

    function stopDraw() {
      drawing = false;
      ctx.beginPath();
    }

    function draw(e) {
      if (!drawing) return;
      const x = e.clientX;
      const y = e.clientY - 70;
      ctx.lineWidth = lineWidth;
      ctx.lineCap = 'round';
      ctx.strokeStyle = tool === 'eraser' ? '#fff' : color;

      if (tool === 'pen' || tool === 'eraser') {
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
      } else if (tool === 'shape' && shape !== 'none') {
        redrawHistory();
        drawShape(startX, startY, x, y);
      }
    }

    function drawShape(x1, y1, x2, y2) {
      const w = x2 - x1;
      const h = y2 - y1;
      ctx.strokeStyle = color;
      ctx.lineWidth = lineWidth;
      switch (shape) {
        case 'rectangle': ctx.strokeRect(x1, y1, w, h); break;
        case 'circle':
          ctx.beginPath();
          ctx.arc(x1 + w / 2, y1 + h / 2, Math.abs(w / 2), 0, Math.PI * 2);
          ctx.stroke();
          break;
        case 'line':
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.stroke();
          break;
        case 'arrow':
          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.stroke();
          break;
        case 'triangle':
          ctx.beginPath();
          ctx.moveTo(x1 + w / 2, y1);
          ctx.lineTo(x1, y2);
          ctx.lineTo(x2, y2);
          ctx.closePath();
          ctx.stroke();
          break;
        case 'star': drawStar(x1 + w/2, y1 + h/2, 5, Math.abs(w/2), Math.abs(w/4)); break;
        case 'heart': drawHeart(x1, y1, w, h); break;
        case 'cloud': drawCloud(x1, y1, w, h); break;
      }
    }

    function drawStar(cx, cy, spikes, outerR, innerR) {
      let rot = Math.PI / 2 * 3;
      let x = cx, y = cy;
      const step = Math.PI / spikes;
      ctx.beginPath();
      ctx.moveTo(cx, cy - outerR);
      for (let i = 0; i < spikes; i++) {
        x = cx + Math.cos(rot) * outerR;
        y = cy + Math.sin(rot) * outerR;
        ctx.lineTo(x, y);
        rot += step;

        x = cx + Math.cos(rot) * innerR;
        y = cy + Math.sin(rot) * innerR;
        ctx.lineTo(x, y);
        rot += step;
      }
      ctx.lineTo(cx, cy - outerR);
      ctx.stroke();
    }

    function drawHeart(x, y, w, h) {
      ctx.beginPath();
      const topCurveHeight = h * 0.3;
      ctx.moveTo(x + w / 2, y + h);
      ctx.bezierCurveTo(x + w / 2 + w / 2, y + h - topCurveHeight, x + w, y + h / 3, x + w / 2, y);
      ctx.bezierCurveTo(x, y + h / 3, x + w / 2 - w / 2, y + h - topCurveHeight, x + w / 2, y + h);
      ctx.stroke();
    }

    function drawCloud(x, y, w, h) {
      ctx.beginPath();
      ctx.arc(x + w*0.25, y + h*0.6, h*0.2, Math.PI*0.5, Math.PI*1.5);
      ctx.arc(x + w*0.5, y + h*0.4, h*0.25, Math.PI*1, Math.PI*1.85);
      ctx.arc(x + w*0.75, y + h*0.6, h*0.2, Math.PI*1.5, Math.PI*0.5);
      ctx.closePath();
      ctx.stroke();
    }

    function addText(x, y) {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Type...';
      input.style.position = 'absolute';
      input.style.left = x + 'px';
      input.style.top = y + 'px';
      input.style.border = 'none';
      input.style.background = 'rgba(255,255,255,0.8)';
      input.style.padding = '4px 6px';
      input.style.borderRadius = '4px';
      input.style.fontSize = '16px';
      document.body.appendChild(input);
      input.focus();

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          ctx.fillStyle = color;
          ctx.font = lineWidth * 5 + 'px Poppins';
          ctx.fillText(input.value, x, y);
          input.remove();
        }
      });
    }

    // ===== STICKY NOTES =====
    document.getElementById('addStickyBtn').onclick = () => {
      const note = document.createElement('div');
      note.className = 'sticky-note';
      note.style.top = '100px';
      note.style.left = '100px';
      note.innerHTML = `
        <div class="note-header"><span class="close-btn">√ó</span></div>
        <textarea placeholder="Write here..."></textarea>`;
      document.body.appendChild(note);

      note.querySelector('.close-btn').onclick = () => note.remove();

      let drag = false, offsetX, offsetY;
      note.querySelector('.note-header').onmousedown = (e) => {
        drag = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      };
      document.onmouseup = () => drag = false;
      document.onmousemove = (e) => {
        if (!drag) return;
        note.style.left = e.pageX - offsetX + 'px';
        note.style.top = e.pageY - offsetY + 'px';
      };
    };

    // ===== HISTORY =====
    function saveHistory() {
      const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
      undoStack.push(data);
      if (undoStack.length > 30) undoStack.shift();
      redoStack = [];
    }
    function redrawHistory() {
      if (undoStack.length === 0) return;
      ctx.putImageData(undoStack[undoStack.length - 1], 0, 0);
    }
    document.getElementById('undoBtn').onclick = () => {
      if (undoStack.length === 0) return;
      redoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
      ctx.putImageData(undoStack.pop(), 0, 0);
    };
    document.getElementById('redoBtn').onclick = () => {
      if (redoStack.length === 0) return;
      undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
      ctx.putImageData(redoStack.pop(), 0, 0);
    };

    // ===== CLEAR + DOWNLOAD =====
    document.getElementById('clearBoard').onclick = () => {
      if (confirm('Clear the whiteboard?')) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        undoStack = [];
        redoStack = [];
        localStorage.removeItem('whiteboardData');
      }
    };

    document.getElementById('downloadBtn').onclick = () => {
      const link = document.createElement('a');
      link.download = 'whiteboard.png';
      link.href = canvas.toDataURL();
      link.click();
    };

    // ===== GRID + THEME =====
    document.getElementById('toggleGrid').onclick = () => {
      gridEnabled = !gridEnabled;
      redrawHistory();
      if (gridEnabled) drawGrid();
    };
    function drawGrid() {
      const size = 25;
      ctx.strokeStyle = '#e5e7eb';
      for (let x = 0; x < canvas.width; x += size) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += size) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    document.getElementById('toggleTheme').onclick = () => {
      document.body.classList.toggle('dark');
    };

    // ===== LOCAL STORAGE SAVE =====
    setInterval(() => {
      localStorage.setItem('whiteboardData', canvas.toDataURL());
    }, 5000);

    window.onload = () => {
      const saved = localStorage.getItem('whiteboardData');
      if (saved) {
        const img = new Image();
        img.src = saved;
        img.onload = () => ctx.drawImage(img, 0, 0);
      }
    };
  </script>
</body>
</html>
